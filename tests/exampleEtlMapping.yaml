mappings:
  - name: test_index
    doc_type: subject
    type: aggregator
    root: subject
    props:
      - name: submitter_id
      - name: project_id
      - name: hiv_status
        value_mappings:
          - true: positive
          - false: negative
    parent_props:
      - path: studies[study_objective,study_submitter_id:submitter_id]
    flatten_props:
      - path: demographics
        props:
          - name: gender
            value_mappings:
              - female: Female
              - male: Male
              - unspecified: Not Specified
              - not reported: Not Specified
              - unknown: Unknown
          - name: race
          - name: ethnicity
          - name: dominant_hand
          - name: year_of_birth
          - name: study_center
            src: country_of_birth
      - path: exposures
        props:
          - name: ageatbl
          - name: ageatbl_gt89
          - name: basecch
          - name: basecoc
          - name: basecrack
          - name: baseher
          - name: baseidu
          - name: basefhiv
          - name: basefinj
          - name: basefsex
          - name: basemdonrx
          - name: basemhem
          - name: basemhiv
          - name: baseminj
          - name: basemman
          - name: basemsex
          - name: basenidu
          - name: basepot
          - name: basesbxnrx
          - name: basesex
          - name: basetran
          - name: drug_used
          - name: eductn
          - name: paidsex
          - name: riskcat
          - name: sexident
        sorted_by: updated_datetime, desc
      - path: hiv_history_records
        props:
          - name: arthxbase
          - name: bsdate
          - name: cd4nadir
          - name: fposdate
          - name: frstdthd
          - name: status
          - name: fcd4lowd
          - name: frstaidd
          - name: lastafrd
          - name: lastcond
          - name: lastcontact
          - name: lcd4higd
          - name: lnegdate
          - name: ehaart
          - name: frstartd
          - name: frsthaad
          - name: lastnoad
          - name: lastnohd
      - path: comorbidities
        props:
          - name: bshbvstat
          - name: bshcvstat
          - name: frstcncrd
          - name: frstdmd
          - name: frstdmmd
          - name: frsthtnd
          - name: frsthtnmd
    aggregated_props:
      - name: _visits_count
        path: visits
        fn: count
      - name: _summary_lab_results_on_follow_up_count
        path: visits.summary_lab_results
        fn: count
      - name: _samples_count
        path: samples
        fn: count
      - name: _aliquots_count
        path: samples.aliquots
        fn: count
      - name: _summary_lab_results_on_sample_count
        path: samples.summary_lab_results
        fn: count
      - name: _mrna_microarrays_count
        path: samples.aliquots.mrna_microarrays
        fn: count
      - name: _mirna_microarrays_count
        path: samples.aliquots.mirna_microarrays
        fn: count
      - name: _submitted_unaligned_reads_count
        path: samples.aliquots.read_groups.submitted_unaligned_reads_files
        fn: count
      - name: _min_viral_load
        path: visits.summary_lab_results
        src: viral_load
        fn: min
    joining_props:
      - index: file
        join_on: subject_id
        props:
          - name: data_format
            src: data_format
            fn: set
          - name: data_type
            src: data_type
            fn: set
          - name: file_id
            src: file_id
            fn: set
